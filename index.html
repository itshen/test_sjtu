<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>市场数据可视化分析平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <style>
        .chart-container {
            position: relative;
        }
        .comparison-value {
            font-size: 0.75rem;
            font-weight: 500;
        }
        .trend-up {
            color: #dc2626;
        }
        .trend-down {
            color: #16a34a;
        }
        .trend-neutral {
            color: #6b7280;
        }
        
        /* 特定产品高亮样式 */
        .highlighted-product {
            background-color: #fef3c7 !important; /* 浅黄色背景 */
            font-weight: 600 !important;
        }
        
        .highlighted-product-header {
            background-color: #f59e0b !important; /* 橙色背景 */
            color: white !important;
            font-weight: 700 !important;
        }
        .legend-item-hidden {
            text-decoration: line-through;
            opacity: 0.5;
        }
        
        /* 强制隐藏团队图表的图例 */
        #team-chart-尤菲亚 + .chartjs-legend,
        #team-chart-纳达卡 + .chartjs-legend,
        #team-chart-尼赫鲁 + .chartjs-legend,
        canvas[id^="team-chart"] ~ .legend {
            display: none !important;
        }
        
        /* 预测数据样式 */
        .prediction-data {
            font-style: italic;
            font-weight: bold;
            color: #8B5CF6;
            position: relative;
        }
        

        
        .prediction-btn {
            background: linear-gradient(45deg, #8B5CF6, #6366F1);
            animation: pulse-prediction 2s infinite;
        }
        
        @keyframes pulse-prediction {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .coordinate-point {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .coordinate-point:hover {
            transform: scale(1.2);
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .trend-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
        }
        .trend-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 费用预测显示样式 */
        .cost-display {
            animation: fadeIn 0.3s ease-in-out;
            border-left: 4px solid #3B82F6;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .coordinate-info-section {
            border-bottom: 1px solid #E5E7EB;
            padding-bottom: 4px;
            margin-bottom: 4px;
        }
        
        .coordinate-info-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
        <!-- 标题和时间选择器 -->
        <div class="fixed top-0 left-0 right-0 bg-white shadow-md z-50 border-b">
            <div class="container mx-auto px-3 py-4">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <h1 class="text-2xl font-bold text-gray-800">市场数据可视化分析平台</h1>
                <div class="flex items-center gap-3">
                    <span class="text-sm font-medium text-gray-700">选择期间:</span>
                    <div class="flex gap-1">
                        <button class="period-btn bg-blue-500 text-white px-3 py-1.5 rounded text-sm hover:bg-blue-600 transition-colors" data-period="1A">1A</button>
                        <button class="period-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-period="1B">1B</button>
                        <button class="period-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-period="2">2</button>
                        <button class="period-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-period="3">3</button>
                        <button class="period-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-period="4">4</button>
                        <button class="period-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-period="5">5</button>
                        <button class="period-btn prediction-btn bg-purple-500 text-white px-3 py-1.5 rounded text-sm hover:bg-purple-600 transition-colors border-2 border-dashed font-bold" data-period="6">6</button>
                    </div>
                    <label class="flex items-center gap-2 text-sm">
                        <input type="checkbox" id="show-comparison" class="rounded">
                        <span>显示环比</span>
                    </label>
                </div>
            </div>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="container mx-auto px-3 py-4 pt-24">
        <!-- 行业数据表格 -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-4">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-xl font-bold text-gray-800">整个行业数据</h2>
                <button id="industry-prediction-info-btn" class="bg-indigo-500 text-white px-3 py-1 rounded text-xs hover:bg-indigo-600 transition-colors prediction-info-trigger hidden" title="查看预测算法说明">
                    📊 算法说明
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full table-auto border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-2 text-left">指标</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尤菲亚1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尤菲亚2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">尤菲亚3</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">纳达卡1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">纳达卡2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">纳达卡3</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尼赫鲁1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">尼赫鲁2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尼赫鲁3</th>
                        </tr>
                    </thead>
                    <tbody id="industry-data-tbody">
                        <!-- 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 市场份额表格 -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-4">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-xl font-bold text-gray-800">市场份额</h2>
                <button id="market-share-prediction-info-btn" class="bg-indigo-500 text-white px-3 py-1 rounded text-xs hover:bg-indigo-600 transition-colors prediction-info-trigger hidden" title="查看预测算法说明">
                    📊 算法说明
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full table-auto border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-2 text-left">组序</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尤菲亚P1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尤菲亚P2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">尤菲亚P3</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">纳达卡P1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">纳达卡P2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">纳达卡P3</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尼赫鲁P1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">尼赫鲁P2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尼赫鲁P3</th>
                        </tr>
                    </thead>
                    <tbody id="market-share-tbody">
                        <!-- 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 市场份额分析 -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-4">
            <h2 class="text-xl font-bold text-gray-800 mb-3">市场份额分析</h2>
            
            <!-- 视图切换 -->
            <div class="mb-4 border-b">
                <div class="flex gap-4 mb-3">
                    <button class="view-btn bg-blue-500 text-white px-4 py-2 rounded-t text-sm font-medium border-b-2 border-blue-500" data-view="by-group">按组别查看</button>
                    <button class="view-btn bg-gray-100 text-gray-700 px-4 py-2 rounded-t text-sm font-medium hover:bg-gray-200 transition-colors" data-view="by-product">按产品对比</button>
                </div>
            </div>

            <!-- 按组别查看视图 -->
            <div id="group-view" class="view-content">
                <div class="mb-4">
                    <label class="text-sm font-medium text-gray-700 mr-4">选择组别:</label>
                    <div class="inline-flex gap-2">
                        <button class="group-btn bg-blue-500 text-white px-3 py-1.5 rounded text-sm hover:bg-blue-600 transition-colors" data-group="1">组1</button>
                        <button class="group-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-group="2">组2</button>
                        <button class="group-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-group="3">组3</button>
                        <button class="group-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-group="4">组4</button>
                        <button class="group-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-group="5">组5</button>
                    </div>
                </div>
                <div class="chart-container h-96">
                    <canvas id="market-share-chart"></canvas>
                </div>
            </div>

            <!-- 按产品对比视图 -->
            <div id="product-view" class="view-content hidden">
                <div class="mb-4">
                    <label class="text-sm font-medium text-gray-700 mr-4">选择产品:</label>
                    <div class="inline-flex gap-2 flex-wrap">
                        <button class="product-btn bg-blue-500 text-white px-3 py-1.5 rounded text-sm hover:bg-blue-600 transition-colors" data-product="尤菲亚P1">尤菲亚P1</button>
                        <button class="product-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-product="尤菲亚P2">尤菲亚P2</button>
                        <button class="product-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-product="尤菲亚P3">尤菲亚P3</button>
                        <button class="product-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-product="纳达卡P1">纳达卡P1</button>
                        <button class="product-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-product="纳达卡P2">纳达卡P2</button>
                        <button class="product-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-product="纳达卡P3">纳达卡P3</button>
                        <button class="product-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-product="尼赫鲁P1">尼赫鲁P1</button>
                        <button class="product-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-product="尼赫鲁P2">尼赫鲁P2</button>
                        <button class="product-btn bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm hover:bg-gray-400 transition-colors" data-product="尼赫鲁P3">尼赫鲁P3</button>
                    </div>
                </div>
                <div class="chart-container h-96">
                    <canvas id="product-comparison-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- 市场定价 -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-4">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-xl font-bold text-gray-800">市场定价</h2>
                <button id="market-pricing-prediction-info-btn" class="bg-indigo-500 text-white px-3 py-1 rounded text-xs hover:bg-indigo-600 transition-colors prediction-info-trigger hidden" title="查看预测算法说明">
                    📊 算法说明
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full table-auto border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-2 text-left">组序</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尤菲亚P1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尤菲亚P2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">尤菲亚P3</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">纳达卡P1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">纳达卡P2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">纳达卡P3</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尼赫鲁P1</th>
                            <th class="border border-gray-300 px-4 py-2 text-center highlighted-product-header">尼赫鲁P2</th>
                            <th class="border border-gray-300 px-4 py-2 text-center">尼赫鲁P3</th>
                        </tr>
                    </thead>
                    <tbody id="market-pricing-tbody">
                        <!-- 动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 各团队产品特性坐标对比 -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-4">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-xl font-bold text-gray-800">各团队产品特性坐标对比</h2>
                <div class="text-sm text-gray-600 bg-green-50 px-3 py-1 rounded-full border border-green-200">
                    📊 各组产品在矩阵中的位置、趋势和预测
                </div>
            </div>
            
            <!-- 产品特性坐标数据表格 -->
            <div class="overflow-x-auto mb-4">
                <table class="w-full table-auto border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-3 py-2 text-left">组别</th>
                            <th class="border border-gray-300 px-3 py-2 text-center">雷墨磁1</th>
                            <th class="border border-gray-300 px-3 py-2 text-center">雷墨磁2</th>
                            <th class="border border-gray-300 px-3 py-2 text-center">雷墨磁3</th>
                            <th class="border border-gray-300 px-3 py-2 text-center">平均偏离度</th>
                            <th class="border border-gray-300 px-3 py-2 text-center">趋势</th>
                        </tr>
                    </thead>
                    <tbody id="team-comparison-tbody">
                        <!-- 动态生成 -->
                    </tbody>
                </table>
            </div>
            
            <!-- 各组产品在各市场的位置矩阵图表 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                <!-- 尤菲亚市场各组产品位置 -->
                <div class="border rounded-lg p-3">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 text-center">尤菲亚市场 - 各组产品位置</h3>
                    <div class="chart-container h-64">
                        <canvas id="team-chart-尤菲亚"></canvas>
                    </div>
                </div>
                <!-- 纳达卡市场各组产品位置 -->
                <div class="border rounded-lg p-3">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 text-center">纳达卡市场 - 各组产品位置</h3>
                    <div class="chart-container h-64">
                        <canvas id="team-chart-纳达卡"></canvas>
                    </div>
                </div>
                <!-- 尼赫鲁市场各组产品位置 -->
                <div class="border rounded-lg p-3">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 text-center">尼赫鲁市场 - 各组产品位置</h3>
                    <div class="chart-container h-64">
                        <canvas id="team-chart-尼赫鲁"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 市场理想值坐标图 -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-4">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-xl font-bold text-gray-800">市场理想值 - 扭矩vs电阻坐标图</h2>
                <div class="text-sm text-gray-600 bg-blue-50 px-3 py-1 rounded-full border border-blue-200">
                    💰 将鼠标悬停在坐标图上查看研发预算
                </div>
            </div>
            
            <!-- 费用计算方法说明 -->
            <div class="bg-gray-50 rounded-lg p-4 mb-4 border border-gray-200">
                <div class="flex items-center mb-3">
                    <h3 class="text-lg font-semibold text-gray-800">📊 费用计算方法</h3>
                    <button id="toggle-calculation-details" class="ml-2 text-blue-600 text-sm hover:text-blue-800">
                        [展开详情]
                    </button>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">🎯 计算原理</h4>
                        <div class="text-sm text-gray-600 space-y-1">
                            <p>• 基于历史研发数据的扭矩和电阻变化成本模型</p>
                            <p>• 考虑不同产品类型的研发难度系数</p>
                            <p>• 使用线性插值估算中间值</p>
                            <p>• 复合参数调整增加复杂性成本</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">💡 使用方法</h4>
                        <div class="text-sm text-gray-600 space-y-1">
                            <p>• 将鼠标悬停在任意坐标位置</p>
                            <p>• 查看各产品调整到该位置的预算</p>
                            <p>• 预算包含最小值、平均值、最大值</p>
                            <p>• 调整量 = 目标位置 - 当前位置</p>
                        </div>
                    </div>
                </div>
                
                <!-- 详细计算公式（默认隐藏） -->
                <div id="calculation-details" class="hidden mt-4 pt-4 border-t border-gray-300">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium text-gray-700 mb-3">📈 扭矩变化费用模型</h4>
                            <div class="bg-white rounded p-3 text-xs">
                                <table class="w-full text-xs">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-left py-1">扭矩变化</th>
                                            <th class="text-left py-1">最小费用</th>
                                            <th class="text-left py-1">最大费用</th>
                                            <th class="text-left py-1">成功率</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-600">
                                        <tr><td>0.7</td><td>$1.1M</td><td>$1.15M</td><td>67%</td></tr>
                                        <tr><td>1.0</td><td>$0.18M</td><td>$0.40M</td><td>0%</td></tr>
                                        <tr><td>1.4</td><td>$1.38M</td><td>$1.38M</td><td>100%</td></tr>
                                        <tr><td>4.0</td><td>$4.0M</td><td>$6.0M</td><td>50%</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-700 mb-3">⚡ 电阻变化费用模型</h4>
                            <div class="bg-white rounded p-3 text-xs">
                                <table class="w-full text-xs">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-left py-1">电阻变化</th>
                                            <th class="text-left py-1">最小费用</th>
                                            <th class="text-left py-1">最大费用</th>
                                            <th class="text-left py-1">成功率</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-600">
                                        <tr><td>0.4</td><td>$0.18M</td><td>$0.40M</td><td>0%</td></tr>
                                        <tr><td>0.8</td><td>$0.75M</td><td>$0.75M</td><td>0%</td></tr>
                                        <tr><td>0.9</td><td>$1.10M</td><td>$1.15M</td><td>100%</td></tr>
                                        <tr><td>1.0</td><td>$1.38M</td><td>$1.38M</td><td>100%</td></tr>
                                        <tr><td>4.0</td><td>$4.0M</td><td>$6.0M</td><td>50%</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium text-gray-700 mb-3">🔧 产品类型系数</h4>
                            <div class="bg-white rounded p-3 text-sm">
                                <div class="space-y-1 text-gray-600">
                                    <p>• 雷墨磁1: 0.671 (单位变化成本)</p>
                                    <p>• 雷墨磁2: 0.734 (单位变化成本)</p>
                                    <p>• 雷墨磁3: 0.671 (单位变化成本)</p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-700 mb-3">🧮 计算公式</h4>
                            <div class="bg-white rounded p-3 text-sm">
                                <div class="space-y-2 text-gray-600 font-mono text-xs">
                                    <p>最终费用 = (扭矩费用 + 电阻费用) × 产品系数 × 风险调整</p>
                                    <p>复杂性调整 = 双参数变化时 × 1.2</p>
                                    <p>风险调整 = 1 + (1 - 成功率) × 0.5</p>
                                    <p>插值 = 线性插值已知数据点</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 bg-blue-50 rounded p-3 border border-blue-200">
                        <h4 class="font-medium text-blue-800 mb-2">📚 数据来源</h4>
                        <div class="text-sm text-blue-700">
                            <p>基于提供的扭矩和电阻研发历史案例分析，包含成功和失败案例的预算范围、变化量和成功率统计。
                            算法通过线性回归和加权平均等方法，结合产品类型特征，预测不同参数调整的研发成本。</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                <!-- 尤菲亚市场 -->
                <div class="border rounded-lg p-3">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 text-center">尤菲亚市场</h3>
                    <div class="chart-container h-64">
                        <canvas id="chart-尤菲亚"></canvas>
                    </div>
                </div>
                <!-- 纳达卡市场 -->
                <div class="border rounded-lg p-3">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 text-center">纳达卡市场</h3>
                    <div class="chart-container h-64">
                        <canvas id="chart-纳达卡"></canvas>
                    </div>
                </div>
                <!-- 尼赫鲁市场 -->
                <div class="border rounded-lg p-3">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 text-center">尼赫鲁市场</h3>
                    <div class="chart-container h-64">
                        <canvas id="chart-尼赫鲁"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 趋势分析模态框 -->
    <div id="trend-modal" class="trend-modal">
        <div class="bg-white w-full h-full flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                <div class="flex items-center gap-4">
                    <h3 id="trend-title" class="text-xl font-semibold text-gray-800"></h3>
                    <div class="text-sm text-gray-600">
                        键盘提示: ← → 切换期间 | ESC 关闭
                    </div>
                </div>
                <button id="close-trend" class="text-gray-500 hover:text-gray-700 text-3xl">&times;</button>
            </div>
            <div class="flex-1 p-6 overflow-hidden">
                <div class="h-full">
                    <!-- 产品选择器 -->
                    <div class="mb-4">
                        <div class="flex flex-wrap gap-2" id="product-selector">
                            <!-- 动态生成 -->
                        </div>
                    </div>
                    <!-- 图表容器 -->
                    <div class="h-[calc(100%-80px)]">
                        <canvas id="trend-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 团队位置详细模态框 -->
    <div id="team-position-modal" class="trend-modal">
        <div class="bg-white w-full h-full flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                <div class="flex items-center gap-4">
                    <h3 id="team-position-title" class="text-xl font-semibold text-gray-800"></h3>
                    <div class="text-sm text-gray-600 bg-green-50 px-3 py-1 rounded-full border border-green-200">
                        💡 支持鼠标滚轮缩放、拖拽移动 | 颜色=组别，数字=产品
                    </div>
                    <div class="text-sm text-gray-600">
                        键盘提示: ESC 关闭
                    </div>
                </div>
                <button id="close-team-position" class="text-gray-500 hover:text-gray-700 text-3xl">&times;</button>
            </div>
            <div class="flex-1 p-6 overflow-hidden">
                <div class="h-full flex gap-4">
                    <!-- 控制面板 -->
                    <div class="w-64 bg-gray-50 rounded-lg p-4 border">
                        <h4 class="font-semibold text-gray-800 mb-3">显示控制</h4>
                        
                        <!-- 图例 -->
                        <div class="mb-4">
                            <h5 class="text-sm font-medium text-gray-700 mb-2">图例说明</h5>
                            <div class="space-y-2 text-xs">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-gray-400" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%)"></div>
                                    <span>市场理想值</span>
                                </div>

                                <div class="mt-3 pt-2 border-t border-gray-300">
                                    <div class="text-xs text-gray-600">
                                        <div><strong>颜色</strong> = 组别 (第1-5组)</div>
                                        <div><strong>数字</strong> = 产品 (1=雷墨磁1, 2=雷墨磁2, 3=雷墨磁3)</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 组别筛选 -->
                        <div class="mb-4">
                            <h5 class="text-sm font-medium text-gray-700 mb-2">组别显示</h5>
                            <div class="space-y-1" id="team-filter-controls">
                                <!-- 动态生成 -->
                            </div>
                        </div>

                        <!-- 产品筛选 -->
                        <div class="mb-4">
                            <h5 class="text-sm font-medium text-gray-700 mb-2">产品显示</h5>
                            <div class="space-y-1" id="product-filter-controls">
                                <!-- 动态生成 -->
                            </div>
                        </div>

                        <!-- 重置按钮 -->
                        <button id="reset-team-chart" class="w-full bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600 transition-colors">
                            重置视图
                        </button>
                    </div>
                    
                    <!-- 图表容器 -->
                    <div class="flex-1 h-full">
                        <canvas id="team-position-detail-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 登录模态框 -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full m-4">
            <div class="p-6">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">访问验证</h2>
                    <p class="text-gray-600 text-sm">请输入访问密码进入系统</p>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">访问密码</label>
                    <input 
                        type="password" 
                        id="access-password" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                        placeholder="请输入6位访问密码"
                        maxlength="6"
                    >
                </div>
                
                <button 
                    id="login-btn"
                    class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors mb-4"
                >
                    进入系统
                </button>
                
                <div id="login-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm"></div>
            </div>
        </div>
    </div>

    <!-- 预测算法说明模态框 -->
    <div id="prediction-info-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg w-full max-w-5xl max-h-[90vh] overflow-auto">
                <div class="p-6 border-b">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-800">🔮 预测算法说明</h2>
                        <button id="close-prediction-modal" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-700">
                                    <strong>重要提示：</strong>历史数据预测仅供参考，实际结果可能因市场变化、政策调整等因素而有所不同。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">📊 预测方法概览</h3>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-medium text-purple-700 mb-2">数据窗口</h4>
                                <p class="text-sm text-gray-600">使用 <strong>Round 2 和 Round 3</strong> 的历史数据进行预测</p>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-medium text-purple-700 mb-2">预测目标</h4>
                                <p class="text-sm text-gray-600">生成 <strong>Round 5</strong> 的预测数值</p>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">🎯 分类预测逻辑</h3>
                            
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h4 class="font-medium text-blue-700 mb-2">📈 订单数据</h4>
                                <p class="text-sm text-gray-600 mb-2"><strong>方法：</strong>线性回归 + 增长率校正</p>
                                <p class="text-sm text-gray-600"><strong>特点：</strong>考虑业务增长趋势，确保预测值合理</p>
                            </div>

                            <div class="bg-green-50 rounded-lg p-4">
                                <h4 class="font-medium text-green-700 mb-2">💰 收入数据</h4>
                                <p class="text-sm text-gray-600 mb-2"><strong>方法：</strong>平均增长率预测</p>
                                <p class="text-sm text-gray-600"><strong>特点：</strong>基于历史增长率计算未来收入</p>
                            </div>

                            <div class="bg-orange-50 rounded-lg p-4">
                                <h4 class="font-medium text-orange-700 mb-2">📊 比率数据</h4>
                                <p class="text-sm text-gray-600 mb-2"><strong>方法：</strong>加权平均 + 趋势调整</p>
                                <p class="text-sm text-gray-600"><strong>特点：</strong>重视最近数据，适合毛利率、市场份额等</p>
                            </div>

                            <div class="bg-red-50 rounded-lg p-4">
                                <h4 class="font-medium text-red-700 mb-2">💸 成本数据</h4>
                                <p class="text-sm text-gray-600 mb-2"><strong>方法：</strong>线性回归 + 通胀保护</p>
                                <p class="text-sm text-gray-600"><strong>特点：</strong>考虑成本上升趋势，设置最小增长率</p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 bg-indigo-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-indigo-800 mb-3">🧮 核心算法</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-medium text-indigo-700 mb-2">线性回归公式</h4>
                                <div class="bg-white rounded p-3 font-mono text-sm">
                                    y = ax + b<br/>
                                    <span class="text-gray-600">其中 a = 斜率, b = 截距</span>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-medium text-indigo-700 mb-2">加权平均公式</h4>
                                <div class="bg-white rounded p-3 font-mono text-sm">
                                    加权平均 = Σ(值ᵢ × 权重ᵢ) / Σ权重ᵢ<br/>
                                    <span class="text-gray-600">最近数据权重更大</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 text-center">
                        <button id="close-prediction-modal-btn" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg transition-colors">
                            明白了
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
        </div>

    <!-- 会话状态显示 -->
    <div id="session-info" class="fixed top-20 left-4 bg-white rounded-lg shadow-md px-4 py-2 text-sm border hidden z-40">
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            <span id="session-timer">--</span>
            <button id="logout-btn" class="ml-2 text-red-600 hover:text-red-800">退出</button>
        </div>
    </div>

    <!-- 提示框 -->
    <div id="tooltip" class="tooltip"></div>

    <script src="auth.js"></script>
    <script src="data.js"></script>
    <script src="app.js"></script>
</body>
</html>
